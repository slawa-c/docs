====== FTP w2k12r2 ======


Затем настроим брандмауэр:

    netsh advfirewall firewall add rule name=”FTP” action =allow protocol=TCP dir=in localport=21
    

<code>











</code>



===== Установка FTP в Windows Server 2012 =====
<code>
В панели мониторинга диспетчера сервера выберите Добавить роли и компоненты.

На странице Выбор ролей сервера разверните узел Веб-сервер (IIS), а затем разверните узел FTP-сервер.

Установите флажок FTP-сервер и флажок Служба FTP, а затем нажмите кнопку Далее.

На странице Выбор компонентов нажмите кнопку Далее.

На странице Подтверждение выбранных элементов для установки нажмите кнопку Установить.
</code>


===== Добавление FTP-сайта =====
<code>

После установки службы FTP на веб-сервере IIS можно добавлять FTP-сайты. 
Добавляйте FTP-сайт, когда требуется разрешить клиентам передавать файлы на сайт и 
с сайта с помощью протокола FTP.

Примечание
Поскольку параметры FTP содержатся в разделе сайтов, изменение какого-либо параметра FTP также вызывает перезапуск приложения веб-сайта. Чтобы исключить этот сторонний эффект, добавляйте сайт, настроенный исключительно для FTP, вместо сайта для HTTP и FTP.

Добавление FTP-сайта

Откройте диспетчер IIS.

В области Подключения разверните узел сервера и щелкните узел Сайты.

В области Действия выберите команду Добавить FTP-сайт, чтобы открыть мастер добавления FTP-сайта.

На странице сведений о сайте в поле Имя FTP-сайта введите уникальное понятное имя для FTP-сайта.

В поле Физический путь введите физический путь или нажмите кнопку обзора (...), 
чтобы найти физический путь к каталогу содержимого.

Нажмите кнопку Далее, чтобы открыть страницу Параметры привязки и SSL.

В разделе Привязка в списке IP-адрес выберите или введите IP-адрес, 
если не требуется оставить значение Все неназначенные.

В поле Порт введите номер порта.

Дополнительно можно ввести имя узла в поле Виртуальный узел, если планируется разместить 
несколько FTP-сайтов на одном IP-адресе. Например, введите www.contoso.com.

Если планируется запускать сайт вручную, снимите флажок Запускать FTP-сайт автоматически.

В разделе SSL в списке Сертификат SSL выберите сертификат. 
Дополнительно можно нажать Обзор, чтобы открыть диалоговое окно 
Сертификаты и проверить сведения об избранном сертификате.

Выберите один из следующих вариантов.

Разрешить SSL: разрешает FTP-серверу поддерживать как SSL-соединения, так и другие соединения с клиентом.
Требовать SSL: требует SSL-шифрование для обмена данными между FTP-сервером и клиентом.

Нажмите кнопку Далее, чтобы открыть страницу сведений о проверке подлинности и авторизации.

В разделе Проверка подлинности выберите способы проверки подлинности, которые планируется использовать.
Анонимный доступ: для доступа к контенту пользователю достаточно предоставить только имя пользователя 
anonymous или ftp. (Большинство FTP-клиентов (но не все) автоматически вводит имя пользователя.)

Основная: для доступа к контенту пользователь должен предоставить правильное имя пользователя и пароль.
Поскольку обычная проверка подлинности передает по сети нешифрованные пароли, используйте эту проверку
подлинности только в том случае, если известно, что соединение между клиентом и FTP-сервером является защищенным, например, с помощью SSL.

В разделе Авторизация выберите в списке Разрешить доступ один из следующих вариантов.
Всем пользователям: доступ к контенту разрешен всем пользователям, и анонимным, и идентифицированным.

Анонимным пользователям: анонимные пользователи имеют доступ к контенту.

Указанным ролям или группам пользователей: доступ к контенту разрешен только членам определенных ролей 
или групп пользователей. Укажите в соответствующем поле роль или группу пользователей.

Указанным пользователям: доступ к контенту разрешен только указанным пользователям. 
Введите имя пользователя в соответствующем поле.

Если из списка Разрешить доступ выбирается именно этот параметр, выберите также выбрать одно 
или оба следующих разрешения:

Чтение: авторизованным пользователям разрешается чтение содержимого каталога.

Запись: авторизованным пользователям разрешается запись в этот каталог.
    Нажмите кнопку Готово.
</code>

===== Настройка значений по умолчанию FTP-сайта =====
<code>

Если требуется, чтобы новые FTP-сайты использовали другое значение параметра, можно изменить параметр по умолчанию для FTP-сайта.
noteПримечание
При изменении значения по умолчанию старый параметр в существующих сайтах не переопределяется. Для существующих сайтов значение параметра необходимо изменять вручную.

Настройка параметров по умолчанию FTP-сайта

    Откройте диспетчер IIS.

    В области Подключения разверните узел сервера, а затем разверните узел Сайты.

    В области Действия выберите Параметры FTP-сайта по умолчанию.

    Измените параметры, а затем нажмите кнопку ОК.

В следующей таблице приведены параметры, которые можно настраивать в диалоговом окне Параметры FTP-сайта по умолчанию.
 
Категория параметра 	Имя параметра 	Описание

Общие
	

Разрешить UTF-8
	

Указывает, используется ли кодировка UTF8. Значение по умолчанию — True.

Общие
	

Запускать автоматически
	

Если установлено значение true, то FTP-сайт запускается сразу после создания или при запуске службы FTP. Значение по умолчанию — True.

Подключения
	

Время ожидания канала управления
	

Задает время ожидания (в секундах), после истечения которого подключение прекращается из-за отсутствия активности.

Подключения
	

Время ожидания канала данных
	

Задает время ожидания (в секундах), после истечения которого канал данных прекращается из-за отсутствия активности.

Подключения
	

Отключить группировку сокетов
	

Указывает, используется ли группировка сокетов для сайтов, различающихся по IP-адресу, а не номеру порта или имени узла.

Подключения
	

Максимум подключений
	

Задает максимальное количество одновременных подключений к серверу.

Подключения
	

Сброс при максимальном числе подключений
	

Указывает, должен ли отключаться сеанс FTP при отправке максимального числа запросов на подключение.

Подключения
	

Журнал прослушивания сервера
	

Задает число ожидающих сокетов, которые могут быть помещены в очередь.

Подключения
	

Время ожидания сеанса без проверки подлинности
	

Задает время ожидания, в течение которого после установки нового подключения можно успешно пройти проверку подлинности.

Кэширование учетных данных
	

включен
	

Указывает, включено ли кэширование учетных данных для службы FTP.

Кэширование учетных данных
	

Интервал очистки
	

Задает время существования кэша в секундах для учетных данных, сохраненных в кэше.

Обработка файлов
	

Разрешить чтение файлов во время передачи
	

Указывает, могут ли читаться файлы во время их передачи на сервер.

Обработка файлов
	

Разрешить замену при переименовании
	

Указывает, могут ли файлы переопределять другие файлы при переименовании.

Обработка файлов
	

Сохранять частично переданные файлы
	

Указывает, должны ли сохраняться частично переданные файлы.
</code>

===== Настройка поддержки брандмауэра =====
<code>

 С помощью компонента Поддержка брандмауэра FTP можно настроить следующие параметры, 
позволяющие FTP-серверу принимать пассивные подключения данных от брандмауэра.

 Диапазон портов канала данных. Укажите диапазон портов для пассивных подключений данных. 
Необходимо также открыть этот диапазон портов в брандмауэре. Этот параметр можно настроить 
только на уровне сервера, и диапазон портов "0-0" означает, что следует использовать диапазон временных 
портов сервера. Временный порт — это порт транспортного протокола с коротким временем существования, 
который TCP/IP выделяет из предварительно заданного диапазона.

 Внешний IP-адрес брандмауэра. Укажите внешний IP-адрес брандмауэра, чтобы клиенты знали, 
какой IP-адрес следует использовать при взаимодействии с FTP-сервером через брандмауэр.

Настройка поддержки брандмауэра

 Откройте диспетчер IIS.

В области Подключения выберите узел сервера.

В окне Просмотр возможностей, дважды щелкните пункт Поддержка брандмауэра FTP.

В поле Диапазон портов канала данных укажите диапазон номеров портов (через дефис). 
Например, введите 5000-6000. Можно также указать 0-0, чтобы использовался диапазон портов по умолчанию,
заданный в параметрах Windows TCP/IP.

Примечание
Не используйте порты от 0 до 1024, поскольку они являются зарезервированными.

В поле Внешний IP-адрес брандмауэра укажите IP-адрес брандмауэра.

В области Действия нажмите кнопку Применить.
</code>

===== Настройка изоляции пользователей =====
<code>

Функция изоляции пользователей позволяет настроить FTP-сервер для изоляции пользователей, которая запрещает пользователям доступ к каталогам других пользователей на одном и том же FTP-сайте. Если решено не изолировать пользователей, то они будут совместно использовать общую структуру каталогов.

Например, можно не изолировать пользователей на сайте, который предлагает только возможности загрузки общедоступного контента, или на сайте, который не требует защиты данных от других пользователей.

Если требуется изолировать пользователей на сайте, можно выбрать один из следующих параметров изоляции.

    Каталог имени пользователя: пользовательские сеансы изолируются в физическом или виртуальном каталоге с именем учетной записи пользователя FTP. Пользователь может видеть только свой корневой путь FTP и, следовательно, не может перейти на уровень выше своего физического или виртуального дерева папок. Любые создаваемые глобальные виртуальные каталоги игнорируются.

    Физический каталог имени пользователя: пользовательские сеансы изолируются в физическом каталоге с именем учетной записи пользователя FTP. Пользователь может видеть только свой корневой путь FTP и, следовательно, не может перейти на уровень выше своего физического дерева папок. Все создаваемые глобальные виртуальные каталоги относятся ко всем пользователям.

    Корневой каталог FTP настроен в Active Directory: пользовательские сеансы изолируются в домашнем каталоге, настроенном в параметрах учетной записи Active Directory для каждого пользователя FTP.

Настройка изоляции пользователей

    Откройте диспетчер IIS.

    В окне Просмотр возможностей, дважды щелкните пункт Изоляция пользователя FTP.

    Если изоляция пользователей не требуется, то в разделе Не изолировать пользователей. Начинать сеансы пользователей в, выберите один из следующих параметров.
        Корневой каталог FTP: указывает, что все сеансы FTP запускаются в корневом каталоге FTP-сайта. Этот параметр отключает все изоляции пользователей и логику исходной папки.

        Каталог имени пользователя: указывает, что все сеансы FTP запускаются в физическом или виртуальном каталоге с именем текущего пользователя, выполнившего вход, если такой каталог существует; в противном случае сеанс FTP запускается в корневом каталоге для FTP-сайта.

    Если требуется изолировать пользователей, то в разделе Изолировать пользователей. Ограничить пользовательский доступ следующим каталогом выберите один из следующих параметров.
        Каталог имени пользователя (отключить глобальные виртуальные каталоги): сеансы пользователя изолируются в физическом или виртуальном каталоге с именем учетной записи пользователя FTP.

        Физический каталог имени пользователя (включить глобальные виртуальные каталоги): сеансы пользователя изолируются в физическом каталоге с именем учетной записи пользователя FTP.

        Корневой каталог FTP настроен в Active Directory: сеансы пользователя изолируются в домашнем каталоге, настроенном в параметрах учетной записи Active Directory для каждого пользователя FTP.

        Настраиваемые: Этот параметр является дополнительным и позволяет разработчикам создавать настраиваемых поставщиков, обеспечивающих поиск в корневом каталоге на основе их уникальных бизнес-требований.

    Если на предыдущем шаге был выбран параметр Корневой каталог FTP настроен в Active Directory, нажмите кнопку Задать , а затем введите в полях Имя пользователя и Пароль диалогового окна Задать учетные данные имя и пароль пользователя, который имеет доступ к серверу Active Directory. Еще раз введите пароль в поле Подтверждение пароля и нажмите кнопку ОК.

    В области Действия нажмите кнопку Применить.

</code>

===== Настройка параметров просмотра каталогов =====
<code>

Функция просмотра каталогов дает возможность управления тем, что отображается при просмотре пользователями каталогов FTP.
Настройка параметров просмотра каталогов

    Откройте диспетчер IIS.

    В области Подключения выберите уровень сервера или уровень сайта.

    В окне Просмотр возможностей дважды щелкните элемент Просмотр каталогов FTP.

    На странице Просмотр каталогов FTP в разделе Стиль вывода каталогов выберите один из следующих параметров.
        MS-DOS: содержимое каталога отображается, как в MS-DOS.

        UNIX: содержимое каталога отображается, как в UNIX.

    В разделе Параметры отображения списка каталогов выберите сведения, которые должны отображаться в списке каталогов. Можно выбрать любые следующие параметры.
        Виртуальные каталоги: отображаются виртуальные каталоги.

        Доступно байт: отображается размер файла в байтах.

        Год из четырех знаков: год отображается четырьмя цифрами, а не двумя.

    В области Действия нажмите кнопку Применить.
</code>

===== Настройка ограничения попыток входа =====
<code>

Эта функция позволяет настроить максимальное число неудачных попыток входа, разрешенное в течение указанного времени, прежде чем IP-адрес будет отклонен.
Настройка ограничения попыток входа

    Откройте диспетчер IIS.

    В области Подключения выберите уровень сервера.

    В окне Просмотр возможностей, дважды щелкните элемент Ограничение попыток входа на FTP.

    На странице Ограничение попыток входа на FTP установите флажок Включить ограничение попыток входа на FTP.

    В поле Максимальное число неудачных попыток входа введите целое положительное число. Значение по умолчанию — 4.

    В поле Период времени (в секундах) введите положительное число. Значение по умолчанию — 30.

    Выберите либо Запрещать IP-адреса на основе неудачных попыток входа, либо Только запись в журнал. Если выбран параметр Только запись в журнал, службы IIS не будут ограничивать клиентов, даже если будет превышено максимальное число неудачных попыток входа.

    В области Действия нажмите кнопку Применить.

</code>




===== Настройка фильтрации запросов =====
<code>
Используйте страницу компонента Фильтрация запросов FTP, чтобы настроить параметры фильтрации запросов для вашего FTP-сайта. Фильтрация запросов FTP — это компонент безопасности, позволяющий поставщикам услуг Интернета (ISP) и поставщикам услуг по предоставлению приложений в аренду (ASP) ограничить поведение протокола и доступ к содержимому.
Настройка фильтрации запросов

    Откройте диспетчер IIS.

    В области Подключения выберите уровень сервера или уровень сайта.

    В окне Просмотр возможностей дважды щелкните значок Фильтрация запросов FTP.

    Чтобы изменить общие параметры фильтрации запросов, щелкните элемент Изменить параметры компонента в области Действия. Затем измените общие параметры по необходимости.

    Чтобы добавить фильтр на основе расширений имен файлов, перейдите на вкладку Расширение имени файла. В области Действия выберите либо Разрешить расширение имени файла, либо Запретить расширение имени файла. Затем введите расширение в поле Расширение имени файла и нажмите кнопку ОК.

    Чтобы добавить фильтр на основе сегмента URL-адреса (например, имени папки), перейдите на вкладку Скрытые сегменты. В области "Действия" щелкните элемент Добавить скрытый сегмент. Затем введите сегмент в поле Скрытый сегмент и нажмите кнопку ОК.

    Чтобы добавить фильтр на основе последовательности URL-адресов, перейдите на вкладку Запрещенные последовательности URL-адресов. В области Действия нажмите Добавить последовательность URL-адресов. Затем введите последовательность в поле Последовательность URL-адресов и нажмите кнопку ОК.

    Чтобы добавить фильтр на основе команды, перейдите на вкладку Команды. В области Действия выберите либо Разрешить команду, либо Запретить команду. Затем введите команду в поле Команда и нажмите кнопку ОК.
    WarningПредупреждение
    Возможность добавления фильтра на основе команды является дополнительной. Если неправильно использовать эту функцию, можно запретить доступ ко всем FTP-клиентам на сервере.
</code>
    
    
===== Настройка ведения журнала FTP =====
<code>
Чтобы настроить функции ведения журнала на уровне сервера или сайта, а также настроить параметры ведения
журнала, можно использовать компонент Ведение журнала FTP.

Настройка ведения журнала FTP

 Откройте диспетчер IIS.

  В области Подключения выберите уровень сервера или уровень сайта.

  В окне Просмотр возможностей дважды щелкните значок Ведение журнала FTP.

  В меню Один файл журнала на выберите пункт Сайт или Сервер.

  В разделе Файл журнала щелкните элемент Выберите поля W3C и выберите сведения, 
    которые требуется регистрировать в журнале.

  В разделе Каталог введите путь к базовой папке, в которой должны храниться файлы журнала FTP,
   или нажмите кнопку Обзор, чтобы найти эту базовую папку.

  В разделе Кодировка выберите либо UTF8 (однобайтовые и многобайтовые символы), 
   либо ANSI (только однобайтовые символы).

  В разделе Переход на новый файл журнала укажите, когда FTP следует создавать новые файлы журналов,
   выбрав соответствующий параметр из следующего списка.
  
  Расписание: выберите Ежечасно, Ежедневно, Еженедельно или Ежемесячно, 
  чтобы новые файлы журнала создавались через определенные интервалы времени.

  Максимальный размер файла (в байтах): укажите положительное целое число, чтобы новые файлы журнала
   создавались, когда размер файла превысит это число байт.

        Не создавать новые файлы журнала.

    Если требуется, чтобы при именовании и переходе на новый файл журнала использовалось не время
     в формате UTC, а местное время, установите флажок Использовать местное время в имени файла.

    В области Действия нажмите кнопку Применить.

</code>


    
    
    
===== Настройка сообщений FTP =====
<code>

    В области Подключения выберите уровень сервера или уровень сайта.

    В окне Просмотр возможностей дважды щелкните элемент Сообщения FTP.

    На странице Сообщения FTP в разделе Поведение сообщений укажите, каким должно быть поведение сообщений FTP. Можно выбрать любые следующие параметры.
        Отключить заголовок по умолчанию: указывает, должен ли отображаться идентификационный заголовок по умолчанию для FTP-сервера.

        Поддерживать пользовательские переменные в сообщениях: указывает, должен ли отображаться определенный набор пользовательских переменных в сообщениях FTP. Поддерживаются следующие пользовательские переменные:

            %BytesReceived% — число байт, отправленных от сервера клиенту в рамках текущего сеанса;

            %BytesSent% — число байт, отправленных от клиента серверу в рамках текущего сеанса;

            %SessionID% — уникальный идентификатор текущего сеанса;

            %SiteName% — имя FTP-сайта, размещающего текущий сеанс;

            %UserName% — имя учетной записи текущего пользователя, выполнившего вход.

        Отображать подробные сообщения для локальных запросов: указывает, следует ли отображать подробные сообщения об ошибках при подключении FTP-клиента к FTP-серверу на самом сервере (в локальном узле).

    В разделе "Текст сообщения" введите сообщения в следующих полях.
        Заголовок: задает сообщение, которое отображает FTP-сервер при первом подключении FTP-клиента к этому FTP-серверу.

        Приветствие: задает сообщение, которое отображает FTP-сервер при входе FTP-клиента на этот сервер.

        Выход: задает сообщение, которое FTP-сервер отображает при выходе FTP-клиента с этого сервера.

        Максимальное число подключений: задает сообщение, которое отображает FTP-сервер, когда клиенту не удается подключиться, поскольку служба FTP достигла максимально разрешенного числа подключений клиентов.

    В области Действия нажмите кнопку Применить.

</code>

